plugins {
    id 'java'
    id "org.moditect.gradleplugin" version "1.0.0-rc3"
}

apply from: "$rootDir/gradle/gradle_scripts/java.gradle"
apply from: "$rootDir/gradle/gradle_scripts/commons.gradle"
apply from: "$rootDir/gradle/gradle_scripts/lombok.gradle"
apply from: "$rootDir/gradle/gradle_scripts/extension.gradle"

tasks.withType(JavaCompile).configureEach {
    doFirst {
        options.compilerArgs += [
                '--module-path', classpath.asPath
        ]
        classpath = files()
    }
}

configurations {
    compileOnly.extendsFrom(dep)
}

dependencies {
    compileOnly project(':app')
    testImplementation project(':app')
    testImplementation project(':procx')
    testImplementation 'org.apache.commons:commons-lang3:3.12.0'
    implementation 'org.apache.commons:commons-exec:1.3'
    compileOnly group: 'com.dlsc.preferencesfx', name: 'preferencesfx-core', version: '11.15.0'
    compileOnly group: 'com.dlsc.formsfx', name: 'formsfx-core', version: '11.6.0'
}

List<String> jvmDevArgs = [
        "--add-reads", "io.xpipe.ext.proc=ALL-UNNAMED"
]

tasks.withType(Test) {
    jvmArgs += jvmDevArgs
}
